"0","agg30 = weather %>% "
"0","  merge(osmar, by = c(""latitude"", ""longitude""), all.y = TRUE) %>% "
"0","  .[,dummy := ping_time] %>% "
"0","  setkey(driver, ping_time, dummy) %>% "
"0","  foverlaps(int30, type = ""within"","
"0","              mult = ""all"", nomatch = NULL) %>% "
"0","  .[,.(start_time = mean(start_time), end_time = mean(end_time),"
"0","       interval_time = mean(interval_time), distance = mean(distance), "
"0","       precip_intensity = mean(precip_intensity, na.rm = TRUE),"
"0","       precip_probability = mean(precip_probability, na.rm = TRUE),"
"0","       wind_speed = mean(wind_speed, na.rm = TRUE),"
"0","       visibility = mean(visibility, na.rm = TRUE),"
"0","       speed_limit = mean(speed_limit, na.rm = TRUE),"
"0","       num_lanes = mean(num_lanes, na.rm = TRUE)), "
"0","    .(driver, interval_id)] %>% "
"0","  merge(driver, by = ""driver"") %>% "
"0","  setkey(driver, start_time, end_time) %>% "
"0","  foverlaps(sce, by.x = c(""driver"", ""start_time"", ""end_time""),"
"0","            type = ""any"", mult = ""all"", nomatch = NA) %>% "
"0","  .[,.(n_SCE = sum(!is.na(event_time)), "
"0","       SCE_time = paste(event_time, collapse = "";""),"
"0","       SCE_type = paste(event_type, collapse = "";""),"
"0","       start_time = mean(start_time), end_time = mean(end_time),"
"0","       interval_time = mean(interval_time), distance = mean(distance), "
"0","       age = mean(age), "
"0","       precip_intensity = mean(precip_intensity, na.rm = TRUE),"
"0","       precip_probability = mean(precip_probability, na.rm = TRUE),"
"0","       wind_speed = mean(wind_speed, na.rm = TRUE),"
"0","       visibility = mean(visibility, na.rm = TRUE),"
"0","       speed_limit = mean(speed_limit, na.rm = TRUE),"
"0","       num_lanes = mean(num_lanes, na.rm = TRUE)),"
"0","    .(driver, interval_id)] %>% "
"0","  .[,SCE_binary := ifelse(n_SCE >= 1, 1, 0)] %>% "
"0","  .[,`:=`(wind_speed = ifelse(is.na(wind_speed), mean(wind_speed, na.rm = TRUE), wind_speed),"
"0","          visibility = ifelse(is.na(visibility), mean(visibility, na.rm = TRUE), visibility))] %>% "
"0","  setkey(driver, start_time, end_time) %>% "
"0","  foverlaps(shiftd, type = ""within"", mult = ""all"", nomatch = NA) %>% "
"0","  .[,cum_drive := cumsum(interval_time)/60, .(driver, shift_ID)]"
"0","fwrite(agg30, ""data/31-analyses_30_minute_intervals.csv"")"
